<?php include(dirname(__FILE__)."/../php_scripts/check_admin.php");?> <?php include(dirname(__FILE__)."/../php_scripts/connection.php");?> <?php include(dirname(__FILE__)."/php_scripts/downline_list.php");?> <?php $msg=""; if(isset($_SESSION['msg'])) { $msg=$_SESSION['msg']; $msg=str_replace("<br />","\n",$msg); unset($_SESSION['msg']); } ?> <?php $session_id=$_SESSION['log_id']; $start="0"; $start_1="0"; if(isset($_GET['page'])) { $start=$_GET['page']; $start_1=$_GET['page']; if((filter_var($start, FILTER_VALIDATE_REGEXP,array("options"=>array("regexp"=>"/[^0-9]+/"))))) { $start="0"; } } $sort_by="name"; if(isset($_GET['sort_by'])) { $sort_by=$_GET['sort_by']; } ?> <!doctype html> <html> <head> <meta charset="utf-8"> <title>My Downline</title> <script src="../javascript/jquery_file.js"></script> <link rel="stylesheet" type="text/css" href="../css/style.css" /> <style> legend{ font-weight:bold; font-size:1.1em; } fieldset{ padding:20px; } .tables_fieldset{ width:100%; font-weight:bold; color:#333; } </style> </head> <body> <input type="hidden" id="error" value="<?php echo($msg);?>" /> <div id="content_main"><br><br> <table style="width:90%;margin:auto;font-size:1.5em;color:#333;" border="0" cellpadding="3px" cellspacing="0" class="breadcrumb"> <tr> <td><a href="index.php">Dashboard</a> > Downline List</td> </tr> </table> <table style="width:90%;margin:auto;font-size:1.1em;color:#333;line-height:25px;" border="0" cellpadding="3px" cellspacing="0" class="breadcrumb"> <tr> <td align="right">Sort By : <a href="downline_list.php?sort_by=name">Name</a> | <a href="downline_list.php?sort_by=id">ID</a>&nbsp;</td> </tr> </table> <table style="width:90%;margin:auto;font-size:1em;color:#FFF;" border="1" cellpadding="3px" cellspacing="0"> <tr style="font-weight:bold;background-color:#333;color:#EEE;"> <td style="width:30px;">S.NO</td> <td>ID</td> <td>NAME</td> <td>CITY, STATE</td> <td>SPONSOR</td> <td>PHONE NO</td> <td>EMAIL ID</td> <td>REGISTRATION DATE</td> <td>STATUS</td> <?php if($_SESSION['logged']=="admin") { echo("<td></td>"); } ?> </tr> <?php $new_conn = new mysqli($host_db,$user_db,$pass_db,$name_db); if ($new_conn->connect_errno) { echo("COULD NOT CONNECT TO THE SERVER.....TRY AGAIN LATER"); exit(); } else { $downlinestring=""; get_downline_listall($session_id,$new_conn,$downlinestring); if($downlinestring=="") { $pages="0"; } else { $downline_array=explode(",",$downlinestring); $total=count($downline_array); $per_page="50"; $start=$start*$per_page; $sno=$start_1*$per_page+1; if($sort_by=="id") { $res=$new_conn->query("SELECT a.id,a.first_name,a.last_name,a.created_date,a.phone_no,a.email_id,a.c_city,a.c_state,b.status,b.sponsor_id,c.first_name AS sponsor_first_name,c.last_name AS sponsor_last_name FROM mlm_user_details a INNER JOIN mlm_login b ON a.id=b.id INNER JOIN mlm_user_details c ON c.id=b.sponsor_id WHERE b.id IN($downlinestring) ORDER BY a.id LIMIT $start,$per_page"); } else { $res=$new_conn->query("SELECT a.id,a.first_name,a.last_name,a.created_date,a.phone_no,a.email_id,a.c_city,a.c_state,b.status,b.sponsor_id,c.first_name AS sponsor_first_name,c.last_name AS sponsor_last_name FROM mlm_user_details a INNER JOIN mlm_login b ON a.id=b.id INNER JOIN mlm_user_details c ON c.id=b.sponsor_id WHERE b.id IN($downlinestring) ORDER BY a.first_name,a.last_name,a.id LIMIT $start,$per_page"); } $pages_1=$total%$per_page; $pages=(int)($total/$per_page); if($pages_1>0) { $pages++; } while($detail=$res->fetch_assoc()) { echo("<tr style=\"color:#000;\" valign=\"top\">"); echo("<td>".$sno."</td>"); echo("<td>".$detail['id']."</td>"); echo("<td>".$detail['first_name']." ".$detail['last_name']."</td>"); echo("<td>".$detail['c_city'].", ".$detail['c_state']."</td>"); echo("<td>".$detail['sponsor_id']." - ".$detail['sponsor_first_name']." ".$detail['sponsor_last_name']."</td>"); $phone=explode(",",$detail['phone_no']); $total_phone_no=count($phone); echo("<td>"); for($i=0;$i<$total_phone_no;$i++) { echo($phone[$i]."<br />"); } echo("</td>"); $phone=explode(",",$detail['email_id']); $total_phone_no=count($phone); echo("<td>"); for($i=0;$i<$total_phone_no;$i++) { echo($phone[$i]."<br />"); } echo("</td>"); echo("<td>".$detail['created_date']."</td>"); echo("<td>".ucfirst($detail['status'])."</td>"); if($_SESSION['logged']=="admin") { echo("<td><a href=\"activate_deactivate.php?id=".$detail['id']."&request_url=downline_list\">Change Status</a></td>"); } echo("</tr>"); $sno++; } } $new_conn->close(); } ?> </table> <table style="width:90%;margin:auto;font-size:1em;" border="0" cellpadding="3px" cellspacing="0" class="page_no"> <tr> <td> <table> <?php if($pages>1) { echo("<tr>"); echo("<td>Page : </td>"); for($i=1;$i<=$pages;$i++) { $j=$i-1; if($start_1==$j) { echo("<td>&nbsp;".$i."&nbsp;</td>"); } else { echo("<td>&nbsp;<a href=\"downline_list.php?page=".$j."\">".$i."</a>&nbsp;</td>"); } } echo("</tr>"); } ?> </table> </td> </tr> </table> <br><br> </div> <?php include(dirname(__FILE__)."/common/left_menu_var.php");?> <?php ?> <?php include(dirname(__FILE__)."/common/left_menu.php");?> <?php include(dirname(__FILE__)."/common/main_menu_var.php");?> <?php $top_genealogy=$top_val; ?> <?php include(dirname(__FILE__)."/common/main_menu.php");?> <script src="javascript/menu.js"></script> <script src="javascript/arrange_content.js"></script> <script src="../javascript/error_alert.js"></script> </body> </html>